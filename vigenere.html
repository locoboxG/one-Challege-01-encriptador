<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Challenge Encriptador</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="style2.css">
</head>
<body>
    <nav>
        <img src="imagenes/logo.png">
    </nav>
    <main>
        <section id="entrada">
            <textarea placeholder="Ingrese el texto aqui" id="txtEntra"> Ingrese el texto aqui</textarea>
            <p id="inst1">&#9888; Solo letras minúsculas y sin acentos</p>
            <input type="text" id="txtLlave"  required placeholder="escribe aqui la llave"/>
            <p id="inst1">&#9888; Solo letras minúsculas, sin acentos ni espacios al menos 6 letras</p>
            <div id="botones">
                <input type="button" value="Encriptar" id="encripta"    onclick="ocultaMensaje()" /> 
                <input type="button" value="Desencriptar" id="descifra" onclick="muestraMensaje()"/> 
            </div>
        </section>            

        <section id="resultado">
            <img src="imagenes/muneco.png" id="muneco">
            <br>
            <p id="inst2">Ningun mensaje fue encontrado </p>
            <p id="inst3">Ingresa el texto que desees encriptar o desencriptar </p>
            <input type="button" value="Copiar" id="copiado"> 
        </section>
    </main>
    <footer>
        <p>Blue Monday Software <--> Negreros Orellana Jose Antonio</p>
        <p>Cifrado Vigenere</p>
    </footer>
</body>

<script>
    document.getElementById('entrada').onfocus; 

    function numeroDe (karac) {
        if (karac>=48 & karac<=57)  { karac -= 47;}              // digitos
        if (karac>=97 & karac<=122) { karac = karac - 96 + 10;}  // letras
        if (karac==241)             { karac = 37;}               // ñ
        return karac;
    }

    function caracterDe (karac) {
        if (karac <= 10) {karac+=47;}
        else if (karac <= 36) {karac+=86;}
        else {karac=241;}
        return karac;
    }

    function desplaza (letra, mueve) {
            let result = numeroDe(letra) 
            if (mueve > 0) {
                result += numeroDe(Math.abs(mueve));
                result %= 37;
            } else {
                result -= numeroDe(Math.abs(mueve));
                if (result <=0) { result += 37};
            }
        return result;
    }

    function ocultaMensaje() {
        var origenD = document.getElementById("txtEntra").value;
        var cLim = origenD.length;
        var llaveD = document.getElementById("txtLlave").value;
        var lLim =  llaveD.length;
        var destinoD = "";
        for (var cx= 0; cx<cLim; cx++) {
            cy = cx % lLim; 
            let cadenita  = origenD.charCodeAt(cx);
            let llavecita = llaveD.charCodeAt(cy);
            let codificado = desplaza(cadenita,llavecita);
            destinoD = destinoD.concat(String.fromCharCode(caracterDe(codificado)));
            //alert (cadenita +"("+ numeroDe(cadenita) + ") + " + llavecita +"("+ numeroDe(llavecita) + ") = " + codificado+"("+ caracterDe(codificado) +")");
            //aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
            //0123456789abcdefghijklmnopqrstuvwxyzñ
        }
        document.getElementById("muneco").style.width = 0;
        document.getElementById("muneco").style.height = 0;
        document.getElementById("inst2").innerHTML = "Mensaje Encriptado";
        document.getElementById("inst3").innerHTML = destinoD;
        document.getElementById("copiado").style.opacity = 1;
    }

    document.getElementById("copiado").onclick = function() {
        var mensaje = document.getElementById("inst3").innerHTML;
        /*alert (mensaje); */
        navigator.clipboard.writeText(mensaje)
        .then(() =>   {console.log('Text copied to clipboard');  })
        .catch(err => {console.error('Error in copying text: ', err); });
    }

    function muestraMensaje() {
        var origenD = document.getElementById("txtEntra").value;
        var cLim = origenD.length;
        var llaveD = document.getElementById("txtLlave").value;
        var lLim =  llaveD.length;
        var cx= 0;
        var destinoD = "";
        var exito = true;

        for (var cx= 0; cx<cLim; cx++) {
            cy = cx % lLim; 
            let cadenita  = origenD.charCodeAt(cx);
            let llavecita = llaveD.charCodeAt(cy);
            let codificado = desplaza(cadenita,-llavecita);
            destinoD = destinoD.concat(String.fromCharCode(caracterDe(codificado)));
            //alert (cadenita +"("+ numeroDe(cadenita) + ") - " + llavecita +"("+ numeroDe(llavecita) + ") = " + codificado+"("+ caracterDe(codificado) +")");            
        }

        document.getElementById("muneco").style.width = 0;
        document.getElementById("muneco").style.height = 0;
        document.getElementById("inst2").innerHTML = "Mensaje Encriptado";
        document.getElementById("inst3").innerHTML = destinoD;
        document.getElementById("copiado").style.opacity = 1;
    }


</script>

</html>

